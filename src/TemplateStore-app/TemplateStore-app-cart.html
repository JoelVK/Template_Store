<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/granite-bootstrap/granite-bootstrap.html">



<dom-module id="templatestore-app-cart">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
        <style include="granite-bootstrap"></style>
        <link rel="stylesheet" href="https://checkout.stripe.com/v3/checkout/button.css"></link>
        <script src="https://checkout.stripe.com/checkout.js"></script>
        <style>

            :host {
                display: block;
            }
            .container{
                @apply(--layout-flex);
            }
            iron-list {
                flex-direction: row;
                height: auto;
                width: 100%;
            }
            paper-card{
                background-color: white;
                border-radius: 8px;
                width: 80%;
                margin: 5vw 5vw 5vw 5vw;
            }
            paper-button{
                margin: 16px;
            }
            .item{
                padding: 8px;
            }
            .test{
                border: 3px red;
            }
            .templatePic {
              width: 90%;
            }
            .customRed {
              background-color: #DA3849;
              border-radius: .25rem;
              color: white;
              width: 19vw;
            }
            .customGreen {
              background-color: #5FB760;
              width: 90%;
              color:white;

            }
            .content {
              margin-left: 20px;
              font-weight: bold;
            }
            ul {
              list-style: none;
            }
        </style>

        <firebase-app id="myFireApp"
                       api-key="AIzaSyCMnPwWwViwYiCYPHWgw9oycdoq2yo-jo0"
                       auth-domain="templatestore-cis371.firebaseapp.com"
                       database-url="https://templatestore-cis371.firebaseio.com"
                       project-id="templatestore-cis371"
                       storage-bucket="templatestore-cis371.appspot.com"></firebase-app>
        <firebase-auth user="{{user}}"></firebase-auth>
        <firebase-query path="/users/[[user.uid]]/cart" data="{{cartData}}"></firebase-query>
        <div class="row">
          <div class="col-7">
            <paper-card heading="Items">
            <iron-list items="[[cartData]]" as="cart">
                <template>
                    <ul>
                      <div class="item layout horizontal wrap">
                          <li>
                            <div class="content">
                              <p>Item: [[cart.name]]</p>
                            </div>
                            <div class="card-actions">
                              <paper-button raised class="customRed" on-click="removeFromCart"><iron-icon icon="icons:add-shopping-cart"></iron-icon>Remove from Cart</paper-button>
                            </div>
                          </li>
                        </div>
                      </ul>
                </template>
            </iron-list>
            </paper-card>
          </div>
          <div class="col-5">
                    <paper-card>
                       <paper-button raised class="customGreen" on-click="donate">Donate to Download</paper-button>
                    </paper-card>
          </div>
        </div>


        <!--- We probably dont want to allow anyone to add new templates. Templates can be added in firebase console
        <paper-dialog id="newTemplate" modal on-iron-overlay-closed="diaClosed">
            <paper-input id="nameInput" label="Name"></paper-input>
            <paper-input id="costInput" label="Cost"></paper-input>
            <paper-input id="sourceInput" label="Source"></paper-input>
            <div class="buttons">
                <paper-button dialog-dismiss>Cancel</paper-button>
                <paper-button dialog-confirm> Add</paper-button>
            </div>
        </paper-dialog>
        <paper-button raised id="diaBtn" on-click="addNewTemplate">Add New</paper-button>
        --->
    </template>

    <script>/**
     * @customElement
     * @polymer
     */


    class TemplateStoreAppCart extends Polymer.Element {
            constructor() {
                super();
            }
            static get is() {
                return 'templatestore-app-cart';
            }
            removeFromCart(ev){
                var dbRef = this.$.myFireApp.app.database();
                var uid = firebase.auth().currentUser.uid;
                console.log(uid);
                console.log('/users/' + uid + '/cart/' + ev.model.cart.$key);
                dbRef.ref('/users/' + uid + '/cart/' + ev.model.cart.$key + '/').remove();
            }
            donate() {
              location.href = "stripeDownload.html";
            };

        }
        window.customElements.define(TemplateStoreAppCart.is, TemplateStoreAppCart);
    </script>

</dom-module>
